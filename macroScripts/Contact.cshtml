@using System.Text
@using umbraco
<script src="/scripts/jQuery/jquery.maskedinput.min.js" type="text/javascript"></script>
<div id="contact">
	<form runat="server" id="ContactForm" name="Contact" method="post">
		<fieldset>
			<legend>Contact Us</legend>
			<div class="required">
				<label for="Name">Name</label>@Html.TextBox("Name")
				<div class="ReqErrorMsg">This field is required.</div>
			</div>
			<div class="required">
				<label for="Phone">Phone</label>@Html.TextBox("Phone")
				<div class="ReqErrorMsg">This field is required.</div>
			</div>
			<div class="required">
				<label for="Email">Email</label>@Html.TextBox("Email")
				<div class="ReqErrorMsg">This field is required.</div>
			</div>
			<div class="required">
				<label for="contactMethod">Best way to contact you?</label>
				<div class="radio">
					<label>Email</label>
					@Html.RadioButton("conactMethod", "Email")
					<label>Phone</label>
					@Html.RadioButton("conactMethod", "Phone")
				</div>
			</div>
			<div class="required">
				<label for="contactTime">Best time to contact you?</label>
				<div class="radio">
					<label>AM</label>
					@Html.RadioButton("conactTime", "AM")
					<label>PM</label>
					@Html.RadioButton("conactTime", "PM")
				</div>
			</div>
			<div class="required">
				<label for="Comments">Questions/Comments</label>
				@Html.TextArea("Comments", new { @cols = "40", @rows = "4" })
			</div>
			<div>
				<label for="newsletter">Receive our periodic Newsletter?</label>
				@Html.CheckBox("newsletter", true)
			</div>
			<button type="submit">Submit</button>
		</fieldset>
	</form>
	<div id="right">
		<address>
			American City Plumbing, Inc.<br />
			14519 Plank St.<br />
			Fort Wayne, In 46818<br />
			<strong>Phone:</strong> 260.483.7661<br />
			<strong>Fax:</strong> 260.637.2664<br />
			<strong>License #:</strong> PC 81065017   
		</address>
		<br />
		<iframe width="400" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=American+city+plumbing&amp;aq=&amp;sll=41.648175,-85.003789&amp;sspn=0.117882,0.264187&amp;ie=UTF8&amp;hq=American+city+plumbing&amp;hnear=&amp;t=m&amp;ll=41.352072,-85.120697&amp;spn=0.412352,0.547943&amp;z=10&amp;iwloc=A&amp;output=embed"></iframe>
	</div>

</div>

@{
	if (IsPost)
	{
		StringBuilder body = new StringBuilder("<h1>Contact Us</h1>");
		bool valid = true;
		string fields = "";
		foreach (string field in this.Request.Form)
		{
			if (string.IsNullOrEmpty(this.Request.Form.GetValues(field).First()))
			{
				valid = false;
				fields += (fields.Length > 0) ? ", #" + field : "#" + field; 
	<script>
		($("#@field").siblings(".ReqErrorMsg").show())();
	</script>
				
				//continue;
			}
			else
			{
	<script>
		($("#@field").siblings(".ReqErrorMsg").hide())();
	</script>		
				
				body.AppendFormat("<b>{0}:</b> {1}<br />", field, this.Request.Form.GetValues(field).First());
			}
		}

		if (valid)
		{
			library.SendMail("jonathan.c.read@gmail.com",
				"jonathan.c.read@gmail.com",
				"Contact Us Form",
				body.ToString(),
				true);
		}

	}
}
<script>

	$(document).ready(function () {
		$(".ReqErrorMsg").hide();
		var emRegEx = /^([a-zA-Z0-9_\-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
		$("#Name").mask("aa?aaaaaaaaaaaa aa?aaaaaaaaaaaaaaaaaa");
		$("#Phone").mask("(999) 999-9999? ext99999", { placeholder: "#" });
	});
	$("#ContactForm").submit(function () {
		var valid = true;
		var formData = $(this).serialize().split("&");
		for (var i in formData) {
			var field = formData[i].split("=")[0].replace("=", "");
			if (formData[i].split("=")[1].length == 0) {
				valid = false;
				$("#" + field).siblings(".ReqErrorMsg").show();
			}
			else {
				$("#" + field).siblings(".ReqErrorMsg").hide();
			}
		}
		return valid;
	});
</script>
